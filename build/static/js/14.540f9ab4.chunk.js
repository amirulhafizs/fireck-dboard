(this["webpackJsonpfireck-cms"]=this["webpackJsonpfireck-cms"]||[]).push([[14],{726:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return l}));var r=n(13),c=function(){var e=r.b.getState().user;return"Bearer "+(e?e.token:null)},a=function(e){var t=e.collectionId,n=e.orderBy,r=e.startAt,a=e.startAfter,o=e.where,i=e.limit,s=void 0===i?10:i,l=e.populateRef,u=void 0===l||l,d="".concat(window.location.origin,"/api/").concat(t,"?limit=").concat(s,"&populateRef=").concat(u).concat(n?"&orderBy=".concat(n):"").concat(r?"&startAt=".concat(r):a?"&startAfter=".concat(a):"").concat(o?"&where=".concat(o):"");return fetch(d,{headers:{Authorization:c()}}).then((function(e){return e.json()}))},o=function(e,t){try{return fetch(window.location.origin+"/api/".concat(e),{method:"POST",headers:{Authorization:c()},body:JSON.stringify(t)}).then((function(e){return e.json()}))}catch(n){return{error:n}}},i=function(e,t){try{return fetch(window.location.origin+"/api/".concat(e,"/").concat(t),{method:"DELETE",headers:{Authorization:c()}}).then((function(e){return e.json()}))}catch(n){return{error:n}}},s=function(e,t){try{return fetch(window.location.origin+"/api/".concat(e).concat(t?"/".concat(t):"","?populateRef=false"),{headers:{Authorization:c()}}).then((function(e){return e.json()}))}catch(n){return{error:n}}},l=function(e,t,n){try{return fetch(window.location.origin+"/api/".concat(e,"/").concat(t),{method:"PUT",headers:{Authorization:c()},body:JSON.stringify(n)}).then((function(e){return e.json()}))}catch(r){return{error:r}}}},727:function(e,t,n){"use strict";var r=n(10),c=n(142),a=n(88),o=n.n(a),i=n(1);t.a=function(e){var t=e.className,n=Object(c.a)(e,["className"]);return Object(i.jsx)("div",Object(r.a)(Object(r.a)({},n),{},{className:o()("text-27px text-white font-medium capitalize leading-none",t)}))}},728:function(e,t,n){"use strict";var r=n(142),c=n(10),a=n(734),o=n(675),i=n(0),s=n.n(i),l=n(88),u=n.n(l),d=n(1),b=s.a.forwardRef((function(e,t){return Object(d.jsx)("div",Object(c.a)(Object(c.a)({},e),{},{ref:t,children:Object(d.jsx)(a.b,{className:"text-red-500",size:20})}))}));t.a=function(e){var t=e.className,n=void 0===t?"":t,a=e.options,i=e.error,s=e.white,l=void 0!==s&&s,f=Object(r.a)(e,["className","options","error","white"]);return Object(d.jsxs)("div",{className:"".concat(n," relative flex items-center"),children:[Object(d.jsx)("select",Object(c.a)(Object(c.a)({className:u()("px-3 h-34px border-2 border-solid w-full rounded outline-none",{"border-red-400":i,"focus:border-blue-300":!i,"border-gray-300 bg-gray-300":!l,"border-white bg-white":l})},f),{},{spellCheck:!1,children:a.map((function(e,t){return Object(d.jsx)("option",{"data-testid":"select-option-".concat(e.value),value:e.value,children:e.label},"opt-"+t)}))})),i?Object(d.jsx)(o.a,{title:i,placement:"top",children:Object(d.jsx)(b,{className:"absolute right-2 my-auto w-auto"})}):null]})}},729:function(e,t,n){"use strict";var r=n(45),c=n(46);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=c(n(0)),o=(0,r(n(47)).default)(a.createElement("path",{d:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z"}),"AddRounded");t.default=o},772:function(e,t,n){"use strict";var r=n(45),c=n(46);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=c(n(0)),o=(0,r(n(47)).default)(a.createElement("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Create");t.default=o},920:function(e,t,n){"use strict";n.r(t);var r=n(10),c=n(19),a=n(7),o=n.n(a),i=n(14),s=n(5),l=n(39),u=n(0),d=n.n(u),b=n(729),f=n.n(b),j=n(728),h=n(919),m=["find","find one","count","create","update","delete","type"],x=n(772),p=n.n(x),v=n(144),O=n(1),g=function(e){var t=e.role,n=e.collections,c=e.onSave,a=e.setEditRole,u=d.a.useState(),b=Object(s.a)(u,2),f=b[0],j=b[1],x=d.a.useState(!1),g=Object(s.a)(x,2),w=g[0],N=g[1];d.a.useEffect((function(){t&&j(JSON.parse(JSON.stringify(t)))}),[t]);var y=!(JSON.stringify(t)===JSON.stringify(f));return f?Object(O.jsxs)("div",{className:"bg-gray-300 p-9 rounded",children:[Object(O.jsxs)("div",{className:"flex justify-between mb-3 flex-wrap",children:[Object(O.jsxs)("div",{className:"flex mr-3 mb-4 items-center",children:[Object(O.jsx)("div",{className:"text-2xl font-medium capitalize",children:f.name}),Object(O.jsx)(p.a,{onClick:function(){a(f)},className:"ml-3 text-lg cursor-pointer",fontSize:"inherit"})]}),Object(O.jsx)(l.a,{onClick:Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),e.next=3,c(f);case 3:N(!1);case 4:case"end":return e.stop()}}),e)}))),disabled:!y||w,className:"mb-4 ".concat(y||w?"bg-orange-300 hover:bg-orange-301":"bg-white cursor-default text-gray-500"),children:w?"Saving...":y?"Save":"Saved!"})]}),Object(O.jsx)(v.a,{className:"pb-4 scrollbar-dark",children:Object(O.jsxs)("table",{className:"w-full min-w-544px",children:[Object(O.jsx)("thead",{children:Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{}),m.map((function(e,t){return Object(O.jsx)("th",{className:"font-normal pb-2",children:e},e)}))]})}),Object(O.jsx)("tbody",{children:n.map((function(e,t){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("div",{className:" max-w-135px truncate",children:e.name})}),m.map((function(t,n){return Object(O.jsx)("td",{className:"text-center",children:Object(O.jsx)(h.a,{classes:{checked:"text-blue-400"},checked:!!f.permissions[e.docId]&&f.permissions[e.docId].includes(t),onChange:function(n){return j((function(c){if(null==c)return c;var a=n.target.checked,o=Object(r.a)({},c.permissions);if(a)e.docId in o?(o[e.docId].push(t),o[e.docId].sort((function(e,t){return e>t?1:e<t?-1:0}))):o[e.docId]=[t];else if(e.docId in o){var i=o[e.docId].findIndex((function(e){return e===t}));o[e.docId].splice(i,1),o[e.docId].length||delete o[e.docId]}return Object(r.a)(Object(r.a)({},c),{},{permissions:o})}))}})},t+e.docId)}))]},e.docId)}))})]})})]}):null},w=n(714),N=n(89),y=n(145),k=n(918),I=function(e){var t=e.open,n=e.onClose,r=e.editRole,a=e.onDelete,s=e.onSave,u=e.onCreate,d=Object(y.a)({onSubmit:function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.docId){e.next=5;break}return e.next=3,s(t);case 3:e.next=7;break;case 5:return e.next=7,u(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),enableReinitialize:!0,initialValues:r||{name:"",defaultPermissions:[],permissions:{},docId:""},validate:function(e){var t={};return 0===e.name.length&&(t.name="required"),t}}),b=d.values,f=d.errors,j=d.isSubmitting,x=d.submitCount,p=d.handleChange,v=d.setFieldValue,g=d.handleSubmit;return Object(O.jsx)(w.a,{open:t,hideBackdrop:!0,children:Object(O.jsx)("div",{className:"w-full h-full flex overflow-auto bg-black bg-opacity-40",children:Object(O.jsxs)("div",{className:"m-auto rounded bg-white max-w-644px w-full p-9",children:[Object(O.jsx)("div",{className:"mb-9 font-medium text-2xl",children:b.docId?"Edit role":"Create role"}),Object(O.jsxs)("div",{className:"mb-9",children:[Object(O.jsx)("div",{className:"mb-2",children:"Role name"}),Object(O.jsx)(N.a,{disabled:["public","authenticated"].includes(b.name),onChange:p,name:"name",value:b.name,error:!!(f.name&&x>0)&&f.name})]}),Object(O.jsx)("div",{className:"mb-2",children:"Default permissions"}),Object(O.jsx)("div",{className:"flex flex-wrap mb-9",children:m.map((function(e,t){return Object(O.jsx)("div",{className:"sm:w-1/3 w-1/2",children:Object(O.jsx)(k.a,{classes:{label:"font-poppins line-clamp-1"},control:Object(O.jsx)(h.a,{classes:{checked:"text-blue-300"},className:"mr-3",checked:b.defaultPermissions.includes(e),onChange:function(t){var n=Object(c.a)(b.defaultPermissions);if(t.target.checked)n.push(e);else{var r=n.findIndex((function(t){return t===e}));n.splice(r,1)}v("defaultPermissions",n)}}),label:e})},e)}))}),!r||["public","authenticated"].includes(r.name.toLowerCase())?null:Object(O.jsx)(l.a,{onClick:function(){return a(r.docId)},className:"border-2 border-red-500 text-red-500 mb-10 hover:bg-red-500 hover:text-white",children:"Delete role"}),Object(O.jsxs)("div",{className:"flex justify-between",children:[Object(O.jsx)(l.a,{onClick:function(){return n()},className:"bg-blue-300 hover:bg-blue-400 text-white",children:"Cancel"}),Object(O.jsx)(l.a,{onClick:function(){return g()},className:"bg-orange-300 hover:bg-orange-301",children:j?"Loading...":"Submit"})]})]})})})},S=n(726),C=n(22),R=n(78),z=n(727),E=n(143);t.default=function(){var e=d.a.useState(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],u=d.a.useState([]),b=Object(s.a)(u,2),h=b[0],m=b[1],x=d.a.useState(0),p=Object(s.a)(x,2),v=p[0],w=p[1],N=d.a.useState(),y=Object(s.a)(N,2),k=y[0],A=y[1],D=Object(C.d)((function(e){return e.collectionTypes})),J=Object(R.b)(),P=Object(C.c)();d.a.useEffect((function(){Object(i.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!P){e.next=7;break}return P({type:"SET_LOADING",payload:!0}),e.next=5,Object(S.c)({collectionId:"RolesReservedCollection"});case 5:"error"in(t=e.sent)||m(t);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:return e.prev=12,P({type:"SET_LOADING",payload:!1}),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})))()}),[P]),d.a.useEffect((function(){k&&a(!0)}),[k]);var L=function(){a(!1),A(void 0)},T=function(){var e=Object(i.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.e)("RolesReservedCollection",t.docId,t);case 2:"error"in(n=e.sent)?J(n.error,{variant:"error"}):(m((function(e){var n=Object(c.a)(e);return n[v]=t,n})),J("Role updated!",{variant:"success"})),L();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(i.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.a)("RolesReservedCollection",t);case 2:"error"in(n=e.sent)?J(n.error,{variant:"error"}):(m((function(e){return[Object(r.a)(Object(r.a)({},t),{},{docId:n.docId})].concat(Object(c.a)(e))})),J("Role created!",{variant:"success"})),L();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)({confirmation:"Do you really want to delete this role"});case 2:if(!e.sent){e.next=8;break}return e.next=5,Object(S.b)("RolesReservedCollection",t);case 5:e.sent.error?J("Role was not deleted",{variant:"error"}):(m((function(e){var n=Object(c.a)(e),r=n.findIndex((function(e){return e.docId===t}));return-1===r?e:(n.splice(r,1),n)})),J("Role deleted!",{variant:"success"})),L();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"flex flex-wrap justify-between mb-6",children:[Object(O.jsx)(z.a,{className:"mb-4 mr-4",children:"Roles"}),Object(O.jsx)(l.a,{onClick:function(){return a(!0)},className:"bg-orange-300 hover:bg-orange-301 mb-4",children:Object(O.jsxs)("div",{className:"flex items-center",children:[Object(O.jsx)(f.a,{className:"mr-3 text-lg",fontSize:"inherit"}),Object(O.jsx)("span",{children:"Create role"})]})}),Object(O.jsx)(I,{onCreate:_,onDelete:M,editRole:k,open:n,onSave:T,onClose:function(){a(!1),A(void 0)}})]}),Object(O.jsxs)("div",{className:"flex flex-wrap lg:flex-nowrap",children:[Object(O.jsx)("div",{className:"max-w-192px mb-3 mr-4 block lg:hidden w-full",children:Object(O.jsx)(j.a,{onChange:function(e){return w(parseInt(e.target.value))},value:v,options:h.map((function(e,t){return{label:e.name,value:t}}))})}),Object(O.jsx)("div",{className:"max-w-192px w-full flex-shrink-0 mr-4 hidden lg:block",children:h.map((function(e,t){return Object(O.jsx)("div",{onClick:function(){return w(t)},className:"mb-1 capitalize truncate cursor-pointer ".concat(v===t?"bg-orange-300":"hover:bg-gray-300"," rounded h-34px leading-34px px-3"),children:e.name},"collection-".concat(t))}))}),v<h.length?Object(O.jsx)("div",{className:"lg:flex-grow w-full lg:w-0",children:Object(O.jsx)(g,{setEditRole:function(e){return A(e)},role:h[v],collections:D,onSave:T})}):null]})]})}}}]);
//# sourceMappingURL=14.540f9ab4.chunk.js.map