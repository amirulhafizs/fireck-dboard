{"version":3,"sources":["api/collections.ts","components/PageTitle.tsx","components/EmptyScreen.tsx","components/InViewFetcher.tsx","api/files.ts","pages/Media/index.tsx"],"names":["getAuthHeader","user","store","getState","token","getCollection","collectionId","orderBy","startAt","startAfter","where","limit","populateRef","url","window","location","origin","fetch","headers","Authorization","then","x","json","addDocument","doc","method","body","JSON","stringify","error","deleteDocument","docId","getDocument","updateDocument","collectionType","PageTitle","className","rest","classNames","EmptyScreen","title","onCreate","buttonTitle","onClick","InViewFetcher","fetcher","onValue","onError","React","useState","endReached","setEndReached","onChange","inView","a","res","length","size","uploadFileToStorage","file","Promise","resolve","reject","storage","firebase","metadata","contentType","type","nameParts","name","split","fileName","v4","uploadTask","ref","put","on","snapshot","message","getDownloadURL","downloadUrl","uploadFile","fileDetails","storagePath","deleteFile","delete","formatBytes","b","c","d","Math","floor","log","parseFloat","pow","toFixed","Media","uploadRef","useRef","assets","setAssets","notify","useNotify","useEffect","dispatch","payload","console","multiple","e","files","target","uploaded","variant","prev","noMinWidth","current","click","map","i","open","fontSize","confirm","confirmation","arr","splice","style","paddingTop","backgroundImage","slice","pop","results","createdAt"],"mappings":"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","file":"static/js/14.4e7724df.chunk.js","sourcesContent":["import store from \"store\";\r\n\r\nconst getAuthHeader = () => {\r\n  const user = store.getState().user;\r\n  const token = user ? user.token : null;\r\n  return \"Bearer \" + token;\r\n};\r\n\r\nexport interface Document {\r\n  docId: string;\r\n  created_at: string;\r\n  [index: string]: any;\r\n}\r\n\r\nexport interface GetCollectionOptions {\r\n  collectionId: string;\r\n  orderBy?: string;\r\n  startAt?: number | string;\r\n  startAfter?: number | string;\r\n  where?: string;\r\n  limit?: number;\r\n  populateRef?: boolean;\r\n}\r\n\r\nexport const getCollection = ({\r\n  collectionId,\r\n  orderBy,\r\n  startAt,\r\n  startAfter,\r\n  where,\r\n  limit = 10,\r\n  populateRef = true,\r\n}: GetCollectionOptions) => {\r\n  const url = `${\r\n    window.location.origin\r\n  }/api/${collectionId}?limit=${limit}&populateRef=${populateRef}${\r\n    orderBy ? `&orderBy=${orderBy}` : \"\"\r\n  }${startAt ? `&startAt=${startAt}` : startAfter ? `&startAfter=${startAfter}` : \"\"}${\r\n    where ? `&where=${where}` : \"\"\r\n  }`;\r\n  return fetch(url, { headers: { Authorization: getAuthHeader() } }).then((x) => x.json());\r\n};\r\n\r\nexport const addDocument = (collectionId: string, doc: { [index: string]: any }) => {\r\n  try {\r\n    return fetch(window.location.origin + `/api/${collectionId}`, {\r\n      method: \"POST\",\r\n      headers: { Authorization: getAuthHeader() },\r\n      body: JSON.stringify(doc),\r\n    }).then((x) => x.json());\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport const deleteDocument = (collectionId: string, docId: string) => {\r\n  try {\r\n    return fetch(window.location.origin + `/api/${collectionId}/${docId}`, {\r\n      method: \"DELETE\",\r\n      headers: { Authorization: getAuthHeader() },\r\n    }).then((x) => x.json());\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport const getDocument = (collectionId: string, docId: string) => {\r\n  try {\r\n    return fetch(\r\n      window.location.origin + `/api/${collectionId}${docId ? `/${docId}` : \"\"}?populateRef=false`,\r\n      {\r\n        headers: { Authorization: getAuthHeader() },\r\n      }\r\n    ).then((x) => x.json());\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport const updateDocument = (\r\n  collectionType: string,\r\n  docId: string,\r\n  doc: { [index: string]: any }\r\n) => {\r\n  try {\r\n    return fetch(window.location.origin + `/api/${collectionType}/${docId}`, {\r\n      method: \"PUT\",\r\n      headers: { Authorization: getAuthHeader() },\r\n      body: JSON.stringify(doc),\r\n    }).then((x) => x.json());\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n","import classNames from \"classnames\";\r\n\r\nexport interface PageTitleProps\r\n  extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {}\r\n\r\nconst PageTitle: React.FC<PageTitleProps> = ({ className, ...rest }) => {\r\n  return (\r\n    <div\r\n      {...rest}\r\n      className={classNames(\"text-34px font-medium capitalize leading-none\", className)}\r\n    ></div>\r\n  );\r\n};\r\n\r\nexport default PageTitle;\r\n","import Button from \"components/Button\";\r\n\r\nexport interface EmptyScreenProps {\r\n  title: string;\r\n  buttonTitle: string;\r\n  onCreate: () => void;\r\n}\r\n\r\nconst EmptyScreen: React.FC<EmptyScreenProps> = ({ title, onCreate, buttonTitle }) => {\r\n  return (\r\n    <div className=\"h-96 bg-gray-300 rounded-md flex w-full p-12\">\r\n      <div className=\"m-auto\">\r\n        <div className=\"text-22px mb-5 font-medium text-center\">{title}</div>\r\n        <Button className=\"mx-auto bg-orange-300 hover:bg-orange-301 block\" onClick={onCreate}>\r\n          {buttonTitle}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmptyScreen;\r\n","import Loader from \"components/Loader\";\r\nimport { InView } from \"react-intersection-observer\";\r\nimport React from \"react\";\r\n\r\nexport interface InViewFetcherProps {\r\n  fetcher: () => Promise<Array<any> | { error: any }>;\r\n  onValue: (a: Array<any>) => void;\r\n  onError?: (val: string) => void;\r\n  limit: number;\r\n}\r\n\r\nconst InViewFetcher: React.FC<InViewFetcherProps> = ({\r\n  fetcher,\r\n  onValue,\r\n  limit,\r\n  onError = () => {},\r\n}) => {\r\n  const [endReached, setEndReached] = React.useState(false);\r\n  return (\r\n    <InView\r\n      className=\"w-full\"\r\n      onChange={async (inView) => {\r\n        if (inView && !endReached) {\r\n          let res = await fetcher();\r\n          if (!(\"error\" in res)) {\r\n            onValue(res);\r\n            if (!res.length || res.length < limit) {\r\n              setEndReached(true);\r\n            }\r\n          } else {\r\n            onError(res.error);\r\n            setEndReached(true);\r\n          }\r\n        }\r\n      }}\r\n    >\r\n      {!endReached ? (\r\n        <div className=\"flex justify-center py-3\">\r\n          <Loader size=\"small\"></Loader>\r\n        </div>\r\n      ) : (\r\n        \"\"\r\n      )}\r\n    </InView>\r\n  );\r\n};\r\n\r\nexport default InViewFetcher;\r\n","import firebase from \"firebase\";\r\nimport store from \"store\";\r\nimport { v4 } from \"uuid\";\r\nimport { addDocument, deleteDocument } from \"./collections\";\r\n\r\nexport const uploadFileToStorage = (\r\n  file: File\r\n): Promise<{ downloadUrl: string; fileName: string } | { error: string }> => {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      const storage = firebase.storage();\r\n\r\n      const metadata = {\r\n        contentType: file.type,\r\n      };\r\n\r\n      const nameParts = file.name.split(\".\");\r\n\r\n      const fileName = v4() + \".\" + nameParts[nameParts.length - 1];\r\n      let ref = storage.ref(fileName);\r\n      const uploadTask = ref.put(file, metadata);\r\n      uploadTask.on(\r\n        \"state_changed\",\r\n        (snapshot) => {},\r\n        (error) => {\r\n          resolve({ error: error.message });\r\n        },\r\n        () => {\r\n          uploadTask.snapshot.ref.getDownloadURL().then((downloadUrl) => {\r\n            resolve({ downloadUrl, fileName });\r\n          });\r\n        }\r\n      );\r\n    } catch (error: any) {\r\n      resolve({ error });\r\n    }\r\n  });\r\n};\r\n\r\nexport const uploadFile = async (file: File): Promise<{ error: string } | any> => {\r\n  try {\r\n    const res = await uploadFileToStorage(file);\r\n    if (\"error\" in res) {\r\n      return res;\r\n    } else {\r\n      const fileDetails = {\r\n        name: file.name,\r\n        size: file.size,\r\n        url: res.downloadUrl,\r\n        storagePath: res.fileName,\r\n      };\r\n      return addDocument(\"FilesReservedCollection\", fileDetails);\r\n    }\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport type FileDocument = {\r\n  docId: string;\r\n  name: string;\r\n  size: number;\r\n  storagePath: string;\r\n  createdAt: number;\r\n  url: string;\r\n};\r\n\r\nexport const getFiles = async ({\r\n  limit = 10,\r\n  orderBy,\r\n  startAt,\r\n  startAfter,\r\n}: {\r\n  limit?: number;\r\n  orderBy: string;\r\n  startAt?: string | number;\r\n  startAfter?: string | number;\r\n}): Promise<Array<FileDocument> | { error: string }> => {\r\n  try {\r\n    const user = store.getState().user;\r\n    const token = user ? user.token : null;\r\n    return fetch(\r\n      window.location.origin +\r\n        `/private/files?limit=${limit}${\r\n          startAt ? \"&startAt=\" + startAt : \"\"\r\n        }&orderBy=${orderBy},desc${startAfter ? `&startAfter=${startAfter}` : \"\"}`,\r\n      {\r\n        headers: { Authorization: \"Bearer \" + token },\r\n      }\r\n    ).then((x) => x.json());\r\n  } catch (error: any) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport const getFilesCount = async () => {\r\n  try {\r\n    const user = store.getState().user;\r\n    const token = user ? user.token : null;\r\n    return fetch(window.location.origin + `/private/files/count`, {\r\n      headers: { Authorization: \"Bearer \" + token },\r\n    }).then((x) => x.json());\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n\r\nexport const deleteFile = (docId: string, storagePath: string) => {\r\n  try {\r\n    const storage = firebase.storage();\r\n    storage.ref(storagePath).delete();\r\n\r\n    return deleteDocument(\"FilesReservedCollection\", docId);\r\n  } catch (error) {\r\n    return { error };\r\n  }\r\n};\r\n","import Button from \"components/Button\";\r\nimport { IoAdd } from \"react-icons/io5\";\r\nimport React from \"react\";\r\nimport { FileDocument, deleteFile, uploadFile } from \"api/files\";\r\nimport store from \"store\";\r\nimport InViewFetcher from \"components/InViewFetcher\";\r\nimport ButtonBase from \"@material-ui/core/ButtonBase\";\r\nimport OpenInNew from \"@material-ui/icons/OpenInNew\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport { confirm } from \"components/Confirm\";\r\nimport { useNotify } from \"components/NotificationsProvider\";\r\nimport PageTitle from \"components/PageTitle\";\r\nimport EmptyScreen from \"components/EmptyScreen\";\r\nimport { getCollection } from \"api/collections\";\r\n\r\nexport function formatBytes(a: number, b = 2) {\r\n  if (0 === a) return \"0 Bytes\";\r\n  const c = 0 > b ? 0 : b,\r\n    d = Math.floor(Math.log(a) / Math.log(1024));\r\n  return (\r\n    parseFloat((a / Math.pow(1024, d)).toFixed(c)) +\r\n    \" \" +\r\n    [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"][d]\r\n  );\r\n}\r\n\r\nexport interface MediaProps {}\r\n\r\nconst Media: React.FC<MediaProps> = () => {\r\n  const uploadRef = React.useRef(null as any);\r\n  const [assets, setAssets] = React.useState<Array<FileDocument>>([]);\r\n  const notify = useNotify();\r\n\r\n  React.useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        store.dispatch({ type: \"SET_LOADING\", payload: true });\r\n        const res = await getCollection({\r\n          collectionId: \"FilesReservedCollection\",\r\n          orderBy: \"createdAt\",\r\n        });\r\n        if (\"error\" in res) {\r\n        } else {\r\n          setAssets(res);\r\n        }\r\n\r\n        store.dispatch({ type: \"SET_LOADING\", payload: false });\r\n      } catch (er) {\r\n        console.log(er);\r\n      }\r\n    })();\r\n  }, []);\r\n  return (\r\n    <div>\r\n      <div className=\"flex justify-between flex-wrap mb-7\">\r\n        <PageTitle className=\"mb-4 mr-4\">Media</PageTitle>\r\n        <input\r\n          type=\"file\"\r\n          multiple\r\n          className=\"hidden\"\r\n          ref={uploadRef}\r\n          onChange={async (e) => {\r\n            const files = e.target.files;\r\n            if (files && files.length) {\r\n              store.dispatch({\r\n                type: \"SET_LOADING\",\r\n                payload: `Uploading ${files.length} file${files.length > 1 ? \"s\" : \"\"}...`,\r\n              });\r\n              let uploaded = 0;\r\n              for (let file of files) {\r\n                const res = await uploadFile(file);\r\n                if (!(\"error\" in res)) {\r\n                  uploaded++;\r\n                  store.dispatch({\r\n                    type: \"SET_LOADING\",\r\n                    payload: `${uploaded}/${files.length} uploaded.`,\r\n                  });\r\n                  setAssets((prev) => [res, ...prev]);\r\n                } else {\r\n                  notify(\"Permission denied. Try reload the app\", { variant: \"error\" });\r\n                }\r\n              }\r\n\r\n              store.dispatch({ type: \"SET_LOADING\", payload: false });\r\n            }\r\n          }}\r\n        />\r\n        <Button\r\n          noMinWidth\r\n          onClick={() => uploadRef.current.click()}\r\n          className=\"bg-orange-300 hover:bg-orange-301 mb-4\"\r\n        >\r\n          <div className=\"flex items-center\">\r\n            <IoAdd className=\"mr-2\" size={18}></IoAdd>\r\n            <span>Upload</span>\r\n          </div>\r\n        </Button>\r\n      </div>\r\n      {/* <div className=\"mb-6 text-gray-600 leading-none\">{count} files in total</div> */}\r\n      {!assets.length ? (\r\n        <EmptyScreen\r\n          buttonTitle=\"Upload\"\r\n          title=\"There are no media files yet\"\r\n          onCreate={() => uploadRef.current.click()}\r\n        ></EmptyScreen>\r\n      ) : (\r\n        <div className=\"flex flex-wrap -mx-3\">\r\n          {assets.map((x, i) => (\r\n            <div key={`asset-${i}`} className=\"xl:w-3/12 lg:w-4/12 xs:w-6/12 w-full px-3 mb-6\">\r\n              <div className=\"w-full relative rounded-sm overflow-hidden group\">\r\n                <div className=\"absolute top-0 left-0 justify-between p-3 w-full z-20 group-hover:opacity-100 opacity-0 transition duration-200 flex\">\r\n                  <ButtonBase\r\n                    onClick={() => window.open(x.url, \"_blank\")}\r\n                    className=\"outline-none h-26px w-26px rounded bg-orange-300 hover:bg-orange-301\"\r\n                  >\r\n                    <OpenInNew fontSize=\"small\"></OpenInNew>\r\n                  </ButtonBase>\r\n                  <ButtonBase className=\"outline-none h-26px w-26px rounded bg-orange-300 hover:bg-orange-301\">\r\n                    <DeleteIcon\r\n                      fontSize=\"small\"\r\n                      onClick={async () => {\r\n                        if (\r\n                          await confirm({\r\n                            confirmation: \"Do you really want to delete this file?\",\r\n                          })\r\n                        ) {\r\n                          setAssets((prev) => {\r\n                            let arr = [...prev];\r\n                            arr.splice(i, 1);\r\n                            return arr;\r\n                          });\r\n                          const res = await deleteFile(x.docId, x.storagePath);\r\n                          if (!(\"error\" in res)) {\r\n                            notify(\"File deleted!\", { variant: \"success\" });\r\n                          }\r\n                        }\r\n                      }}\r\n                    ></DeleteIcon>\r\n                  </ButtonBase>\r\n                </div>\r\n\r\n                <div style={{ paddingTop: \"61%\" }} className=\"bg-blue-300\"></div>\r\n                <div\r\n                  style={{ paddingTop: \"61%\", backgroundImage: `url(${x.url})` }}\r\n                  className=\"bg-center bg-contain bg-no-repeat absolute left-0 top-0 z-10 w-full\"\r\n                ></div>\r\n\r\n                <div className=\"p-4 bg-gray-300\">\r\n                  <div className=\"line-clamp-1 font-medium mb-3\">{x.name}</div>\r\n                  <div className=\"flex justify-between\">\r\n                    <div>{formatBytes(x.size)}</div>\r\n                    <div>\r\n                      <div className=\"bg-orange-300 rounded px-2 py-0.5 text-sm\">\r\n                        {x.name.split(\".\").slice(-1).pop()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {assets.length ? (\r\n            <InViewFetcher\r\n              limit={10}\r\n              onValue={(results: Array<FileDocument>) => {\r\n                setAssets((prev) => [...prev, ...results]);\r\n              }}\r\n              fetcher={() =>\r\n                getCollection({\r\n                  collectionId: \"FilesReservedCollection\",\r\n                  startAfter: assets[assets.length - 1].createdAt,\r\n                  orderBy: \"createdAt\",\r\n                })\r\n              }\r\n            ></InViewFetcher>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Media;\r\n"],"sourceRoot":""}