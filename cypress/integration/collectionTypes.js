/// <reference types="cypress" />

Cypress.on("uncaught:exception", (err, runnable) => {
  // returning false here prevents Cypress from
  // failing the test
  return false;
});

const LoadAndLogin = () => {
  cy.visit(Cypress.env("APP_URL"));
  cy.window()
    .its("store")
    .invoke("dispatch", {
      type: "SET_USER",
      payload: {
        token:
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6IiQyYSQwOCRaNUUyaVplL3lMNlZnVWh6dmNBeWZ1NVBURDY0NkNNQjhUa0EuZHBBNTM5UzdpeW1uM2YyQyIsImVtYWlsIjoiYWRtaW5AYWRtaW4uY29tIiwic3Vic2NyaWJlRW1haWxzIjpmYWxzZSwicm9sZSI6InN1cGVyLWFkbWluIiwiaWF0IjoxNjMzMjcxNjM2fQ.ht5IgGJpZBGGBDdHexoKWCEJ9S_14_scC15qOm5MX2Q",
      },
    });
};

describe("Collection Types", () => {
  before(() => {
    LoadAndLogin();
  });

  it("Create collection", () => {
    cy.get("[data-testid=add-collection-btn]").click();
    cy.get("[data-testid=collection-name-input]").click();
    cy.get("[data-testid=collection-name-input]").type("kolekcija");
    cy.get("[data-testid=submit-btn]").click();
  });

  it("Add, edit and delete dields", () => {
    cy.get("[data-testid=collection-name-kolekcija]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("str");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=touple-option-true]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("str-l");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-number]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("number");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-map]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("map");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-array]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("array");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-boolean]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("{backspace}");
    cy.get("[data-testid=field-id-input-0]").type("boolean");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-date]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("date");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-media]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("med-ma");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-media]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("med-on");
    cy.get("[data-testid=touple-option-true]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-rich-text]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("rich");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-json]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("jso");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-enum]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("enu");
    cy.get("[data-testid=enum-option-input-0]").click();
    cy.get("[data-testid=enum-option-input-0]").type("one");
    cy.get("[data-testid=add-enum-option-btn-0]").click();
    cy.get("[data-testid=enum-option-input-0]").click();
    cy.get("[data-testid=enum-option-input-0]").type("two");
    cy.get("[data-testid=add-enum-option-btn-0]").click();
    cy.get("[data-testid=enum-option-input-0]").click();
    cy.get("[data-testid=enum-option-input-0]").type("three");
    cy.get("[data-testid=add-enum-option-btn-0]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-password]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("passwor");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-relation]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("relat-one");
    cy.get("[data-testid=related-collection-select-0]").select("everything");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-relation]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=touple-option-false]").click();
    cy.get("[data-testid=related-collection-select-0]").select("everything");
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("rel-one-man");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=add-new-field-btn]").click();
    cy.get("[data-testid=fieldtype-option-collection]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").type("subcoll");
    cy.get('[data-testid="add-field-for-subcollection-btn-0"] > path').click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-1]").click();
    cy.get("[data-testid=field-id-input-1]").clear().type("string");
    cy.get("[data-testid=submit-field-details-btn-1]").click();
    cy.get("[data-testid=add-field-for-subcollection-btn-0]").click();
    cy.get("[data-testid=fieldtype-option-collection]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-1]").click();
    cy.get("[data-testid=field-id-input-1]").type("subsubcollection");
    cy.get('[data-testid="add-field-for-subcollection-btn-1"] > path').click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-2]").click();
    cy.get("[data-testid=field-id-input-2]").clear().type("string");
    cy.get("[data-testid=submit-field-details-btn-2]").click();
    cy.get("[data-testid=add-field-for-subcollection-btn-1]").click();
    cy.get("[data-testid=fieldtype-option-number]").click();
    cy.get("[data-testid=submit-field-type-btn]").click();
    cy.get("[data-testid=field-id-input-2]").click();
    cy.get("[data-testid=field-id-input-2]").type("number");
    cy.get("[data-testid=submit-field-details-btn-2]").click();
    cy.get("[data-testid=submit-field-details-btn-1]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-str]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("string");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-str-l]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("string-long");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-number]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-map]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-array]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-boolean]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-date]").click();
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-med-ma]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("media-multiple");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-med-on]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("media-single");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-rich]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("rich-text");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-jso]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("json");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-enu]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("enum");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-passwor]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("password");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-relat-one]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("relation-one-one");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-rel-one-man]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("relation-one-many");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    cy.get("[data-testid=edit-for-field-subcoll]").click();
    cy.get("[data-testid=field-id-input-0]").click();
    cy.get("[data-testid=field-id-input-0]").clear().type("subcollection");
    cy.get("[data-testid=submit-field-details-btn-0]").click();
    LoadAndLogin();
    cy.get("[data-testid=collection-name-kolekcija]").click();
    cy.get("[data-testid=delete-for-field-subcollection]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-relation-one-many]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-relation-one-one]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-password]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-enum]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-json]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-rich-text]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-media-single]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-media-multiple]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-date]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-boolean]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-array]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-map]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-number]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-string-long]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.get("[data-testid=delete-for-field-string]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();

    cy.wait(4000);

    cy.get("[data-testid=delete-for-field-subcollection]").should("not.exist");
    cy.get("[data-testid=delete-for-field-relation-one-many]").should("not.exist");
    cy.get("[data-testid=delete-for-field-relation-one-one]").should("not.exist");
    cy.get("[data-testid=delete-for-field-password]").should("not.exist");
    cy.get("[data-testid=delete-for-field-enum]").should("not.exist");
    cy.get("[data-testid=delete-for-field-json]").should("not.exist");
    cy.get("[data-testid=delete-for-field-rich-text]").should("not.exist");
    cy.get("[data-testid=delete-for-field-media-single]").should("not.exist");
    cy.get("[data-testid=delete-for-field-media-multiple]").should("not.exist");
    cy.get("[data-testid=delete-for-field-date]").should("not.exist");
    cy.get("[data-testid=delete-for-field-boolean]").should("not.exist");
    cy.get("[data-testid=delete-for-field-array]").should("not.exist");
    cy.get("[data-testid=delete-for-field-map]").should("not.exist");
    cy.get("[data-testid=delete-for-field-number]").should("not.exist");
    cy.get("[data-testid=delete-for-field-string-long]").should("not.exist");
    cy.get("[data-testid=delete-for-field-string]").should("not.exist");
  });

  it("Delete collection", () => {
    cy.get("[data-testid=edit-collection-btn]").click();
    cy.get("[data-testid=delete-collection-btn]").click();
    cy.get("[data-testid=dialog-confirm-btn]").click();
    cy.wait(4000);
    cy.get("[data-testid=collection-name-kolekcija]").should("not.exist");
    LoadAndLogin();
    cy.get("[data-testid=collection-name-kolekcija]").should("not.exist");
  });
});
